(function(f,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("three"),require("three/addons/loaders/GLTFLoader.js"),require("three/addons/loaders/DRACOLoader.js"),require("three/addons/loaders/OBJLoader.js"),require("three/addons/loaders/MTLLoader.js"),require("three/addons/loaders/STLLoader.js"),require("three/addons/loaders/FBXLoader.js"),require("three/addons/loaders/TDSLoader.js"),require("three/addons/loaders/AMFLoader.js"),require("three/addons/controls/OrbitControls.js")):typeof define=="function"&&define.amd?define(["exports","three","three/addons/loaders/GLTFLoader.js","three/addons/loaders/DRACOLoader.js","three/addons/loaders/OBJLoader.js","three/addons/loaders/MTLLoader.js","three/addons/loaders/STLLoader.js","three/addons/loaders/FBXLoader.js","three/addons/loaders/TDSLoader.js","three/addons/loaders/AMFLoader.js","three/addons/controls/OrbitControls.js"],c):(f=typeof globalThis<"u"?globalThis:f||self,c(f.CI3DView={},f.THREE,f.THREE,f.THREE,f.THREE,f.THREE,f.THREE,f.THREE,f.THREE,f.THREE,f.THREE))})(this,(function(f,c,$,U,J,Z,X,Y,K,Q,tt){"use strict";const O={src:"",controls:!0,zoom:!0,pan:!0,autoRotate:!1,autoRotateSpeed:.5,autoRotateDelay:3e3,damping:!0,dampingFactor:.1,polarAngleMin:0,polarAngleMax:180,theme:"light",background:"transparent",showProgress:!0,fullscreenButton:!0,backgroundToggleButton:!1,screenshotButton:!1,screenshotFilename:"screenshot",screenshotScale:2,resetCameraButton:!0,autoRotateButton:!0,animationButtons:!0,toolbarPosition:"bottom-center",shadows:!0,shadowOpacity:.3,shadowBlur:2,environmentBackground:!1,toneMapping:"aces",toneMappingExposure:1,draco:!0,autoPlayAnimation:!1,animationSpeed:1,cameraFov:45,antialias:!0,scrollToZoom:!1};function g(e){return e==="true"||e==="1"||e==="yes"||e===""}function b(e){if(e.trim()==="")return;const t=Number(e);return isNaN(t)?void 0:t}function et(e){const t=Number(e);return isNaN(t)?e:t}const ot={src:{key:"src",coerce:String},"mtl-src":{key:"mtlSrc",coerce:String},alt:{key:"alt",coerce:String},controls:{key:"controls",coerce:g},zoom:{key:"zoom",coerce:g},pan:{key:"pan",coerce:g},"auto-rotate":{key:"autoRotate",coerce:g},"auto-rotate-speed":{key:"autoRotateSpeed",coerce:b},"auto-rotate-delay":{key:"autoRotateDelay",coerce:b},damping:{key:"damping",coerce:g},"damping-factor":{key:"dampingFactor",coerce:b},"zoom-min":{key:"zoomMin",coerce:b},"zoom-max":{key:"zoomMax",coerce:b},"polar-angle-min":{key:"polarAngleMin",coerce:b},"polar-angle-max":{key:"polarAngleMax",coerce:b},theme:{key:"theme",coerce:String},background:{key:"background",coerce:String},"show-progress":{key:"showProgress",coerce:g},"fullscreen-button":{key:"fullscreenButton",coerce:g},"background-toggle-button":{key:"backgroundToggleButton",coerce:g},"screenshot-button":{key:"screenshotButton",coerce:g},"screenshot-filename":{key:"screenshotFilename",coerce:String},"screenshot-scale":{key:"screenshotScale",coerce:b},"reset-camera-button":{key:"resetCameraButton",coerce:g},"auto-rotate-button":{key:"autoRotateButton",coerce:g},"animation-buttons":{key:"animationButtons",coerce:g},"toolbar-position":{key:"toolbarPosition",coerce:String},shadows:{key:"shadows",coerce:g},"shadow-opacity":{key:"shadowOpacity",coerce:b},"shadow-blur":{key:"shadowBlur",coerce:b},"environment-map":{key:"environmentMap",coerce:String},"environment-background":{key:"environmentBackground",coerce:g},"tone-mapping":{key:"toneMapping",coerce:String},"tone-mapping-exposure":{key:"toneMappingExposure",coerce:b},draco:{key:"draco",coerce:g},"draco-decoder-path":{key:"dracoDecoderPath",coerce:String},animation:{key:"animation",coerce:et},"auto-play-animation":{key:"autoPlayAnimation",coerce:g},"animation-speed":{key:"animationSpeed",coerce:b},"camera-position":{key:"cameraPosition",coerce:e=>{const t=JSON.parse(e);if(!Array.isArray(t)||t.length!==3||t.some(o=>typeof o!="number"||!isFinite(o)))throw new Error("Expected [x, y, z] tuple of finite numbers");return t}},"camera-fov":{key:"cameraFov",coerce:b},"camera-target":{key:"cameraTarget",coerce:e=>{const t=JSON.parse(e);if(!Array.isArray(t)||t.length!==3||t.some(o=>typeof o!="number"||!isFinite(o)))throw new Error("Expected [x, y, z] tuple of finite numbers");return t}},"pixel-ratio":{key:"pixelRatio",coerce:b},antialias:{key:"antialias",coerce:g},"scroll-to-zoom":{key:"scrollToZoom",coerce:g},lighting:{key:"lighting",coerce:JSON.parse}};function it(e){const t={};for(const[o,i]of Object.entries(ot)){const n=`data-ci-3d-${o}`,a=e.getAttribute(n);if(a!==null)try{t[i.key]=i.coerce(a)}catch(s){console.warn(`CI3DView: failed to parse data attribute "${n}":`,s)}}return t}function z(e){const t={...O};for(const[o,i]of Object.entries(e))i!==void 0&&(o==="lighting"&&typeof i=="object"&&i!==null?t[o]={...O[o],...i}:t[o]=i);return t}function rt(e){const t=[];return e.src||t.push("config.src is required"),e.theme&&!["light","dark"].includes(e.theme)&&t.push(`Invalid theme: "${e.theme}". Must be "light" or "dark".`),e.toneMapping&&!["none","linear","reinhard","aces","filmic"].includes(e.toneMapping)&&t.push(`Invalid toneMapping: "${e.toneMapping}".`),e.polarAngleMin!==void 0&&(e.polarAngleMin<0||e.polarAngleMin>180)&&t.push(`polarAngleMin must be between 0 and 180, got ${e.polarAngleMin}.`),e.polarAngleMax!==void 0&&(e.polarAngleMax<0||e.polarAngleMax>180)&&t.push(`polarAngleMax must be between 0 and 180, got ${e.polarAngleMax}.`),e.shadowOpacity!==void 0&&(e.shadowOpacity<0||e.shadowOpacity>1)&&t.push(`shadowOpacity must be between 0 and 1, got ${e.shadowOpacity}.`),e.animationSpeed!==void 0&&e.animationSpeed<0&&t.push(`animationSpeed must be non-negative, got ${e.animationSpeed}.`),e.pixelRatio!==void 0&&e.pixelRatio<=0&&t.push(`pixelRatio must be positive, got ${e.pixelRatio}.`),e.cameraFov!==void 0&&(e.cameraFov<=0||e.cameraFov>=180)&&t.push(`cameraFov must be between 0 (exclusive) and 180 (exclusive), got ${e.cameraFov}.`),t}const D={none:c.NoToneMapping,linear:c.LinearToneMapping,reinhard:c.ReinhardToneMapping,aces:c.ACESFilmicToneMapping,filmic:c.CineonToneMapping};function nt(e,t){const o=new c.WebGLRenderer({canvas:e,antialias:t.antialias!==!1,alpha:!0,powerPreference:"high-performance"}),i=typeof window<"u"?window.devicePixelRatio:1;return o.setPixelRatio(Math.min(i,t.pixelRatio??2)),o.outputColorSpace=c.SRGBColorSpace,t.shadows&&(o.shadowMap.enabled=!0,o.shadowMap.type=c.PCFSoftShadowMap),I(o,t),e.addEventListener("webglcontextlost",n=>{n.preventDefault()}),e.addEventListener("webglcontextrestored",()=>{o.setPixelRatio(Math.min(i,t.pixelRatio??2)),o.outputColorSpace=c.SRGBColorSpace,t.shadows&&(o.shadowMap.enabled=!0,o.shadowMap.type=c.PCFSoftShadowMap),I(o,t)}),o}function I(e,t){const o=t.toneMapping??"aces";e.toneMapping=D[o]??c.ACESFilmicToneMapping,e.toneMappingExposure=t.toneMappingExposure??1}function at(e,t,o){let i=null;const n=new ResizeObserver(()=>{i&&clearTimeout(i),i=setTimeout(()=>{const s=o.clientWidth,r=o.clientHeight;s===0||r===0||(t.aspect=s/r,t.updateProjectionMatrix(),e.setSize(s,r,!1))},16)});n.observe(o);const a=n.disconnect.bind(n);return n.disconnect=()=>{i&&(clearTimeout(i),i=null),a()},n}function st(e){return D[e]??c.ACESFilmicToneMapping}function lt(e){const t=new c.Scene;return e.background&&e.background!=="transparent"&&(t.background=new c.Color(e.background)),t}function ct(e,t){const o=e.cameraFov??45,i=new c.PerspectiveCamera(o,t,.01,1e3);return e.cameraPosition?i.position.set(e.cameraPosition[0],e.cameraPosition[1],e.cameraPosition[2]):i.position.set(0,1,3),e.cameraTarget&&i.lookAt(e.cameraTarget[0],e.cameraTarget[1],e.cameraTarget[2]),i}function H(){return typeof window<"u"&&typeof document<"u"}function dt(e){if(typeof e=="string"){const t=document.querySelector(e);if(!t)throw new Error(`CI3DView: Element not found for selector "${e}"`);return t}return e}function m(e,t,o){const i=document.createElement(e);if(t&&(i.className=t),o)for(const[n,a]of Object.entries(o))i.setAttribute(n,a);return i}function v(e,...t){e.classList.add(...t)}function k(e,...t){e.classList.remove(...t)}const A=new Map;function ht(e,t){if(!H())return;const o=A.get(t)??0;if(A.set(t,o+1),document.getElementById(t))return;const i=document.createElement("style");i.id=t,i.textContent=e,document.head.appendChild(i)}function ut(e){var o;if(!H())return;const t=(A.get(e)??0)-1;t<0||(t<=0?(A.delete(e),(o=document.getElementById(e))==null||o.remove()):A.set(e,t))}function R(e){e.updateWorldMatrix(!0,!0);const t=new c.Box3;return e.traverse(o=>{if(o instanceof c.Mesh&&o.geometry){o.geometry.computeBoundingBox();const i=o.geometry.boundingBox;if(i&&!i.isEmpty()){const n=i.clone().applyMatrix4(o.matrixWorld);t.union(n)}}}),t.isEmpty()&&t.setFromObject(e),t}function pt(e){const t=R(e),o=new c.Sphere;return t.getBoundingSphere(o),o}function mt(e,t){const o=t.getCenter(new c.Vector3);return e.position.sub(o),o}function gt(e,t,o=2){const i=t.getSize(new c.Vector3),n=Math.max(i.x,i.y,i.z);if(n===0)return 1;const a=o/n;return e.scale.multiplyScalar(a),a}function ft(e,t,o=1.2){const i=e.fov*(Math.PI/180),n=2*Math.atan(Math.tan(i/2)*e.aspect),a=Math.min(i,n),s=t.radius*o/Math.sin(a/2);e.position.set(0,t.radius*.5,s),e.lookAt(0,0,0),e.near=s/100,e.far=s*100,e.updateProjectionMatrix()}function T(e){return e*Math.PI/180}function j(e){const t=new Set,o=new Set;e.traverse(i=>{const n=i;if(n.geometry&&n.geometry.dispose(),n.material){const a=Array.isArray(n.material)?n.material:[n.material];for(const s of a)if(!(!s||t.has(s))){t.add(s);for(const r of Object.keys(s)){const l=s[r];l&&typeof l=="object"&&"isTexture"in l&&l.isTexture&&(o.has(l)||(o.add(l),l.dispose()))}s.dispose()}}})}function bt(e,t){let o=0,i=null;const n=function(...a){const s=Date.now(),r=t-(s-o);r<=0?(i&&(clearTimeout(i),i=null),o=s,e.apply(this,a)):i||(i=setTimeout(()=>{o=Date.now(),i=null,e.apply(this,a)},r))};return n.cancel=()=>{i&&(clearTimeout(i),i=null)},n}const yt="https://www.gstatic.com/draco/versioned/decoders/1.5.7/";let M=null,q=null;function wt(e){return(!M||q!==e)&&(M==null||M.dispose(),M=new U.DRACOLoader,M.setDecoderPath(e),q=e),M}class vt{constructor(){this.extensions=[".glb",".gltf"]}async load(t,o,i){const n=new $.GLTFLoader;if(o.draco!==!1){const a=wt(o.dracoDecoderPath||yt);n.setDRACOLoader(a)}return new Promise((a,s)=>{n.load(t,r=>{a({model:r.scene,animations:r.animations})},r=>{r.total>0&&i&&i(Math.min(r.loaded/r.total,1))},r=>{s(r instanceof Error?r:new Error(String(r)))})})}}class xt{constructor(){this.extensions=[".obj"]}async load(t,o,i){const n=new J.OBJLoader;if(o.mtlUrl)try{const a=await this.loadMtl(o.mtlUrl);a&&(a.preload(),n.setMaterials(a))}catch{}return new Promise((a,s)=>{n.load(t,r=>{r.traverse(l=>{if(l.isMesh&&l.material){const u=(Array.isArray(l.material)?l.material:[l.material]).map(h=>{if(h.type==="MeshPhongMaterial"){const y=new c.MeshStandardMaterial({color:h.color,map:h.map,roughness:.7,metalness:0});return h.map=null,h.dispose(),y}return h});l.material=Array.isArray(l.material)?u:u[0]}}),a({model:r,animations:[]})},r=>{r.total>0&&i&&i(Math.min(r.loaded/r.total,1))},r=>{s(r instanceof Error?r:new Error(String(r)))})})}loadMtl(t){const o=new Z.MTLLoader;return new Promise((i,n)=>{o.load(t,i,void 0,n)})}}class kt{constructor(){this.extensions=[".stl"]}async load(t,o,i){const n=new X.STLLoader;return new Promise((a,s)=>{n.load(t,r=>{r.computeVertexNormals();const l=!!r.getAttribute("color"),d=new c.MeshStandardMaterial({color:l?16777215:8421504,vertexColors:l,roughness:.5,metalness:.3}),u=new c.Mesh(r,d),h=new c.Group;h.add(u),a({model:h,animations:[]})},r=>{r.total>0&&i&&i(Math.min(r.loaded/r.total,1))},r=>{s(r instanceof Error?r:new Error(String(r)))})})}}class Mt{constructor(){this.extensions=[".fbx"]}async load(t,o,i){const n=new Y.FBXLoader;return new Promise((a,s)=>{n.load(t,r=>{a({model:r,animations:r.animations||[]})},r=>{r.total>0&&i&&i(Math.min(r.loaded/r.total,1))},r=>{s(r instanceof Error?r:new Error(String(r)))})})}}class At{constructor(){this.extensions=[".3ds"]}async load(t,o,i){const n=new K.TDSLoader;return new Promise((a,s)=>{n.load(t,r=>{a({model:r,animations:[]})},r=>{r.total>0&&i&&i(Math.min(r.loaded/r.total,1))},r=>{s(r instanceof Error?r:new Error(String(r)))})})}}class St{constructor(){this.extensions=[".amf"]}async load(t,o,i){const n=new Q.AMFLoader;return new Promise((a,s)=>{n.load(t,r=>{a({model:r,animations:[]})},r=>{r.total>0&&i&&i(Math.min(r.loaded/r.total,1))},r=>{s(r instanceof Error?r:new Error(String(r)))})})}}const G=[new vt,new xt,new kt,new Mt,new At,new St];function _(e){const t=e.split("?")[0].split("#")[0],o=t.lastIndexOf("/");return o!==-1?t.substring(o+1):t}function Ct(e){const t=_(e),o=t.lastIndexOf(".");if(o===-1)return"";const i=t.substring(o).toLowerCase();return[".glb",".gltf",".obj",".fbx",".stl",".3ds",".amf"].includes(i)?i:""}function Tt(e){const t=Ct(e);for(const o of G)if(o.extensions.includes(t))return o;return!t&&!_(e).includes(".")?G[0]:null}const S={ambient:{intensity:.4,color:"#ffffff"},key:{intensity:1,color:"#ffffff",position:[5,8,5],castShadow:!0},fill:{intensity:.5,color:"#ffffff",position:[-5,4,-3],castShadow:!1},rim:{intensity:.7,color:"#ffffff",position:[0,4,-8],castShadow:!1}};function Lt(e,t){const o=t||{},i=new c.AmbientLight(new c.Color(o.ambientColor||S.ambient.color),o.ambientIntensity??S.ambient.intensity),n=B(o.keyLight,S.key),a=B(o.fillLight,S.fill),s=B(o.rimLight,S.rim);return e.add(i,n,a,s),{ambient:i,key:n,fill:a,rim:s,originalIntensities:{ambient:i.intensity,key:n.intensity,fill:a.intensity,rim:s.intensity}}}function B(e,t){const o=new c.DirectionalLight(new c.Color((e==null?void 0:e.color)||t.color),(e==null?void 0:e.intensity)??t.intensity),i=(e==null?void 0:e.position)||t.position;o.position.set(i[0],i[1],i[2]);const n=(e==null?void 0:e.castShadow)??t.castShadow;return o.castShadow=n,n&&(o.shadow.mapSize.set(1024,1024),o.shadow.camera.near=.1,o.shadow.camera.far=50,o.shadow.camera.left=-10,o.shadow.camera.right=10,o.shadow.camera.top=10,o.shadow.camera.bottom=-10,o.shadow.radius=2),o}function Et(e,t){t.ambientIntensity!==void 0&&(e.ambient.intensity=t.ambientIntensity),t.ambientColor&&e.ambient.color.set(t.ambientColor),t.keyLight&&P(e.key,t.keyLight),t.fillLight&&P(e.fill,t.fillLight),t.rimLight&&P(e.rim,t.rimLight)}function P(e,t){t.intensity!==void 0&&(e.intensity=t.intensity),t.color&&e.color.set(t.color),t.position&&e.position.set(t.position[0],t.position[1],t.position[2]),t.castShadow!==void 0&&(e.castShadow=t.castShadow)}function Rt(e){e.ambient.intensity=e.originalIntensities.ambient*.5,e.key.intensity=e.originalIntensities.key*.5,e.fill.intensity=e.originalIntensities.fill*.5,e.rim.intensity=e.originalIntensities.rim*.5}function Bt(e,t){const o=Math.max(t*2,1),i=o*5;for(const n of[e.key,e.fill,e.rim])n.castShadow&&(n.shadow.camera.near=.1,n.shadow.camera.far=i,n.shadow.camera.left=-o,n.shadow.camera.right=o,n.shadow.camera.top=o,n.shadow.camera.bottom=-o,n.shadow.camera.updateProjectionMatrix())}function Pt(e,t){t.remove(e.ambient,e.key,e.fill,e.rim),e.ambient.dispose(),e.key.dispose(),e.fill.dispose(),e.rim.dispose()}async function Ft(e,t,o,i){const n=new c.PMREMGenerator(t);n.compileEquirectangularShader();const s=e.split("?")[0].split("#")[0].toLowerCase().endsWith(".exr");let r;if(s){const{EXRLoader:l}=await import("three/addons/loaders/EXRLoader.js");r=new l}else{const{RGBELoader:l}=await import("three/addons/loaders/RGBELoader.js");r=new l}return new Promise((l,d)=>{r.load(e,u=>{const h=n.fromEquirectangular(u).texture;N(o),o.environment=h,i&&(o.background=h),u.dispose(),n.dispose(),l()},void 0,u=>{n.dispose(),d(u instanceof Error?u:new Error(String(u)))})})}function N(e){var o,i;const t=e.background!=null&&e.background===e.environment;e.environment&&((i=(o=e.environment).dispose)==null||i.call(o),e.environment=null),e.background&&typeof e.background.dispose=="function"&&(t||e.background.dispose(),e.background=null)}function Ot(e,t){const o=e.getSize(new c.Vector3),i=Math.max(o.x,o.y,o.z)*3,n=new c.PlaneGeometry(i,i),a=new c.ShadowMaterial({opacity:t.shadowOpacity}),s=new c.Mesh(n,a);return s.rotation.x=-Math.PI/2,s.position.y=e.min.y,s.receiveShadow=!0,s}function W(e,t){t.remove(e),e.geometry.dispose(),e.material.dispose()}function zt(e,t,o){const i=new tt.OrbitControls(e,t);if(i.enableDamping=o.damping!==!1,i.dampingFactor=o.dampingFactor??.1,i.enableZoom=o.zoom!==!1,i.enablePan=o.pan!==!1,i.enableRotate=o.controls!==!1,o.polarAngleMin!==void 0&&(i.minPolarAngle=T(o.polarAngleMin)),o.polarAngleMax!==void 0&&(i.maxPolarAngle=T(o.polarAngleMax)),i.minPolarAngle>i.maxPolarAngle){const n=i.minPolarAngle;i.minPolarAngle=i.maxPolarAngle,i.maxPolarAngle=n}return o.cameraTarget&&i.target.set(o.cameraTarget[0],o.cameraTarget[1],o.cameraTarget[2]),i.update(),i}function Dt(e,t,o){const i=Math.max(t.radius,.01),n=o.zoomMin??i*1.2,a=o.zoomMax??i*5;if(e.minDistance=Math.min(n,a),e.maxDistance=Math.max(n,a),o.polarAngleMin!==void 0&&(e.minPolarAngle=T(o.polarAngleMin)),o.polarAngleMax!==void 0&&(e.maxPolarAngle=T(o.polarAngleMax)),e.minPolarAngle>e.maxPolarAngle){const s=e.minPolarAngle;e.minPolarAngle=e.maxPolarAngle,e.maxPolarAngle=s}e.update()}class It{constructor(t,o){this.resumeTimeout=null,this.enabled=!1,this.onInteractStart=()=>{this.controls.autoRotate=!1,this.resumeTimeout&&(clearTimeout(this.resumeTimeout),this.resumeTimeout=null)},this.onInteractEnd=()=>{this.enabled&&(this.resumeTimeout=setTimeout(()=>{this.controls.autoRotate=!0,this.resumeTimeout=null},this.config.autoRotateDelay))},this.controls=t,this.config=o,t.addEventListener("start",this.onInteractStart),t.addEventListener("end",this.onInteractEnd)}start(){this.enabled=!0,this.controls.autoRotate=!0,this.controls.autoRotateSpeed=this.config.autoRotateSpeed*60}stop(){this.enabled=!1,this.controls.autoRotate=!1,this.resumeTimeout&&(clearTimeout(this.resumeTimeout),this.resumeTimeout=null)}setSpeed(t){this.config.autoRotateSpeed=t,this.controls.autoRotateSpeed=t*60}destroy(){this.controls.removeEventListener("start",this.onInteractStart),this.controls.removeEventListener("end",this.onInteractEnd),this.resumeTimeout&&(clearTimeout(this.resumeTimeout),this.resumeTimeout=null)}}function Ht(e,t,o,i,n=500){var x;if(typeof window<"u"&&((x=window.matchMedia)==null?void 0:x.call(window,"(prefers-reduced-motion: reduce)").matches))return e.position.copy(o),t.target.copy(i),t.update(),{promise:Promise.resolve(),cancel:()=>{}};const s=e.position.clone(),r=t.target.clone(),l=performance.now();let d=null,u=!1;return{promise:new Promise(p=>{function w(){if(u){p();return}const E=performance.now()-l,C=Math.min(E/n,1),V=1-Math.pow(1-C,3);e.position.lerpVectors(s,o,V),t.target.lerpVectors(r,i,V),t.update(),C<1?d=requestAnimationFrame(w):(d=null,p())}d=requestAnimationFrame(w)}),cancel:()=>{u=!0,d!==null&&(cancelAnimationFrame(d),d=null)}}}const jt='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>',qt='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><circle cx="19" cy="5" r="2"/><path d="M20.59 7.13A9.97 9.97 0 0 1 22 12c0 5.52-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2c1.73 0 3.36.44 4.78 1.22"/></svg>',F='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>',Gt='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>',_t='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>',Nt='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>';function Wt(e,t,o){const i=t.resetCameraButton,n=t.autoRotateButton,a=t.animationButtons&&t.hasAnimations,s=t.screenshotButton;if(!i&&!n&&!a&&!s)return null;const r=m("div","ci-3d-toolbar");r.setAttribute("data-position",t.position);let l=null,d=null,u=!1,h=t.autoRotateActive,y=!1;if(i){const p=m("button","ci-3d-toolbar-btn",{"aria-label":"Reset camera"});p.innerHTML=jt,p.addEventListener("click",o.onResetCamera),r.appendChild(p),y=!0}n&&(l=m("button","ci-3d-toolbar-btn",{"aria-label":"Toggle auto-rotate","aria-pressed":String(h)}),h&&l.classList.add("ci-3d-toolbar-active"),l.innerHTML=qt,l.addEventListener("click",()=>{h=!h,o.onAutoRotate(h),l.classList.toggle("ci-3d-toolbar-active",h),l.setAttribute("aria-pressed",String(h))}),r.appendChild(l),y=!0),y&&a&&r.appendChild(m("div","ci-3d-toolbar-separator"));let x=!1;if(a){d=m("button","ci-3d-toolbar-btn",{"aria-label":"Play animation"}),d.innerHTML=F,d.addEventListener("click",()=>{u?o.onPause():o.onPlay()}),r.appendChild(d);const p=m("button","ci-3d-toolbar-btn",{"aria-label":"Stop animation"});p.innerHTML=_t,p.addEventListener("click",()=>{o.onStop(),u=!1,d&&(d.innerHTML=F,d.setAttribute("aria-label","Play animation"))}),r.appendChild(p),x=!0}if((y||x)&&s&&r.appendChild(m("div","ci-3d-toolbar-separator")),s){const p=m("button","ci-3d-toolbar-btn",{"aria-label":"Take screenshot"});p.innerHTML=Nt,p.addEventListener("click",o.onScreenshot),r.appendChild(p)}return e.appendChild(r),{element:r,setAnimationState(p){u=p,d&&(d.innerHTML=p?Gt:F,d.setAttribute("aria-label",p?"Pause animation":"Play animation"))},setAutoRotateState(p){h=p,l&&(l.classList.toggle("ci-3d-toolbar-active",p),l.setAttribute("aria-pressed",String(p)))},destroy(){r.remove()}}}const Vt=".ci-3d-sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.ci-3d-container{--ci-3d-container-bg: transparent;--ci-3d-container-border-radius: 0;--ci-3d-progress-bar-height: 4px;--ci-3d-progress-bar-bg: rgba(0, 0, 0, .1);--ci-3d-progress-bar-fill: #0058a3;--ci-3d-progress-bar-border-radius: 2px;--ci-3d-loading-bg: rgba(255, 255, 255, .9);--ci-3d-loading-color: #333333;--ci-3d-loading-font-family: inherit;--ci-3d-loading-font-size: 14px;--ci-3d-loading-spinner-size: 40px;--ci-3d-loading-spinner-color: #0058a3;--ci-3d-loading-spinner-width: 3px;--ci-3d-error-bg: rgba(255, 255, 255, .95);--ci-3d-error-color: #cc0000;--ci-3d-error-font-size: 14px;--ci-3d-error-icon-size: 48px;--ci-3d-error-retry-bg: #0058a3;--ci-3d-error-retry-color: #ffffff;--ci-3d-error-retry-border-radius: 8px;--ci-3d-error-retry-padding: 8px 16px;--ci-3d-controls-bg: rgba(255, 255, 255, .9);--ci-3d-controls-color: #333333;--ci-3d-controls-border-radius: 8px;--ci-3d-controls-shadow: 0 2px 8px rgba(0, 0, 0, .15);--ci-3d-controls-size: 36px;--ci-3d-controls-gap: 8px;--ci-3d-fullscreen-btn-position-top: 12px;--ci-3d-fullscreen-btn-position-right: 12px;--ci-3d-animation-controls-bg: rgba(255, 255, 255, .9);--ci-3d-animation-controls-color: #333333;--ci-3d-animation-controls-border-radius: 8px;--ci-3d-animation-controls-shadow: 0 2px 8px rgba(0, 0, 0, .15);--ci-3d-transition-duration: .3s;--ci-3d-transition-timing: ease;position:relative;overflow:hidden;width:100%;height:100%;background:var(--ci-3d-container-bg);border-radius:var(--ci-3d-container-border-radius)}.ci-3d-canvas{display:block;width:100%;height:100%;outline:none;cursor:grab}.ci-3d-canvas:active{cursor:grabbing}.ci-3d-loading{position:absolute;top:0;right:0;bottom:0;left:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;background:var(--ci-3d-loading-bg);z-index:10;transition:opacity var(--ci-3d-transition-duration) var(--ci-3d-transition-timing)}.ci-3d-loading--hidden{opacity:0;pointer-events:none}.ci-3d-loading-spinner{width:var(--ci-3d-loading-spinner-size);height:var(--ci-3d-loading-spinner-size);border:var(--ci-3d-loading-spinner-width) solid rgba(0,0,0,.1);border-top-color:var(--ci-3d-loading-spinner-color);border-radius:50%;animation:ci-3d-spin .8s linear infinite}@keyframes ci-3d-spin{to{transform:rotate(360deg)}}.ci-3d-loading-text{font-family:var(--ci-3d-loading-font-family);font-size:var(--ci-3d-loading-font-size);color:var(--ci-3d-loading-color)}.ci-3d-progress-bar{width:60%;max-width:200px;height:var(--ci-3d-progress-bar-height);background:var(--ci-3d-progress-bar-bg);border-radius:var(--ci-3d-progress-bar-border-radius);overflow:hidden}.ci-3d-progress-bar-fill{height:100%;width:0%;background:var(--ci-3d-progress-bar-fill);border-radius:var(--ci-3d-progress-bar-border-radius);transition:width .2s ease}.ci-3d-error{position:absolute;top:0;right:0;bottom:0;left:0;display:none;flex-direction:column;align-items:center;justify-content:center;gap:12px;background:var(--ci-3d-error-bg);z-index:10}.ci-3d-error--visible{display:flex}.ci-3d-error--hidden{display:none}.ci-3d-error-icon{width:var(--ci-3d-error-icon-size);height:var(--ci-3d-error-icon-size);color:var(--ci-3d-error-color)}.ci-3d-error-icon svg{width:100%;height:100%}.ci-3d-error-message{font-size:var(--ci-3d-error-font-size);color:var(--ci-3d-error-color);text-align:center;max-width:80%}.ci-3d-error-retry{background:var(--ci-3d-error-retry-bg);color:var(--ci-3d-error-retry-color);border:none;border-radius:var(--ci-3d-error-retry-border-radius);padding:var(--ci-3d-error-retry-padding);cursor:pointer;font-size:14px;font-weight:500;transition:opacity var(--ci-3d-transition-duration) var(--ci-3d-transition-timing)}.ci-3d-error-retry:hover{opacity:.9}.ci-3d-controls{position:absolute;top:var(--ci-3d-fullscreen-btn-position-top);right:var(--ci-3d-fullscreen-btn-position-right);display:flex;flex-direction:column;gap:var(--ci-3d-controls-gap);z-index:5}.ci-3d-controls button{width:var(--ci-3d-controls-size);height:var(--ci-3d-controls-size);display:flex;align-items:center;justify-content:center;background:var(--ci-3d-controls-bg);color:var(--ci-3d-controls-color);border:none;border-radius:var(--ci-3d-controls-border-radius);box-shadow:var(--ci-3d-controls-shadow);cursor:pointer;padding:0;transition:opacity var(--ci-3d-transition-duration) var(--ci-3d-transition-timing)}.ci-3d-controls button:hover{opacity:.8}.ci-3d-controls button svg{width:18px;height:18px}.ci-3d-animation-controls{position:absolute;bottom:12px;left:50%;transform:translate(-50%);display:flex;flex-direction:row;align-items:center;gap:8px;padding:6px 12px;background:var(--ci-3d-animation-controls-bg);color:var(--ci-3d-animation-controls-color);border-radius:var(--ci-3d-animation-controls-border-radius);box-shadow:var(--ci-3d-animation-controls-shadow);z-index:5}.ci-3d-animation-controls button{width:28px;height:28px;display:flex;align-items:center;justify-content:center;background:none;border:none;color:inherit;cursor:pointer;padding:0;border-radius:4px;transition:background var(--ci-3d-transition-duration) var(--ci-3d-transition-timing)}.ci-3d-animation-controls button:hover{background:#00000014}.ci-3d-animation-controls button svg{width:16px;height:16px}.ci-3d-toolbar{position:absolute;bottom:12px;display:flex;flex-direction:row;align-items:center;overflow:hidden;background:var(--ci-3d-controls-bg);border-radius:var(--ci-3d-controls-border-radius);box-shadow:var(--ci-3d-controls-shadow);z-index:5}.ci-3d-toolbar[data-position=bottom-center]{left:50%;transform:translate(-50%)}.ci-3d-toolbar[data-position=bottom-left]{left:12px}.ci-3d-toolbar[data-position=bottom-right]{right:12px}.ci-3d-toolbar-btn{width:var(--ci-3d-controls-size);height:var(--ci-3d-controls-size);display:flex;align-items:center;justify-content:center;background:transparent;color:var(--ci-3d-controls-color);border:none;cursor:pointer;padding:0;transition:background var(--ci-3d-transition-duration) var(--ci-3d-transition-timing)}.ci-3d-toolbar-btn:hover{background:#00000014}.ci-3d-toolbar-btn.ci-3d-toolbar-active{background:#0000001f}.ci-3d-toolbar-btn svg{width:18px;height:18px}.ci-3d-toolbar-separator{width:1px;height:20px;margin:0 4px;background:#00000026;flex-shrink:0}.ci-3d-animation-select{background:transparent;border:1px solid rgba(0,0,0,.15);border-radius:4px;padding:2px 6px;font-size:12px;color:inherit;cursor:pointer}.ci-3d-theme-dark{--ci-3d-container-bg: #1a1a1a;--ci-3d-progress-bar-bg: rgba(255, 255, 255, .1);--ci-3d-progress-bar-fill: #4fc3f7;--ci-3d-loading-bg: rgba(26, 26, 26, .9);--ci-3d-loading-color: #f0f0f0;--ci-3d-loading-spinner-color: #4fc3f7;--ci-3d-error-bg: rgba(26, 26, 26, .95);--ci-3d-error-color: #ff6b6b;--ci-3d-error-retry-bg: #4fc3f7;--ci-3d-controls-bg: rgba(30, 30, 30, .9);--ci-3d-controls-color: #f0f0f0;--ci-3d-animation-controls-bg: rgba(30, 30, 30, .9);--ci-3d-animation-controls-color: #f0f0f0}.ci-3d-theme-dark .ci-3d-toolbar-btn:hover{background:#ffffff1a}.ci-3d-theme-dark .ci-3d-toolbar-btn.ci-3d-toolbar-active{background:#ffffff26}.ci-3d-theme-dark .ci-3d-toolbar-separator{background:#fff3}.ci-3d-scroll-hint{position:absolute;bottom:16px;left:50%;transform:translate(-50%) translateY(4px);padding:8px 16px;border-radius:20px;background:#000000b3;color:#fff;font-size:13px;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;line-height:1;white-space:nowrap;z-index:100;opacity:0;pointer-events:none;transition:opacity .3s ease,transform .3s ease}.ci-3d-scroll-hint--visible{opacity:1;transform:translate(-50%) translateY(0)}.ci-3d-container--fullscreen{width:100vw!important;height:100vh!important;border-radius:0!important;background:#fff}.ci-3d-theme-dark.ci-3d-container--fullscreen{background:#1a1a1a}.ci-3d-container:focus-visible{outline:2px solid #0058a3;outline-offset:2px}.ci-3d-controls button:focus-visible,.ci-3d-toolbar-btn:focus-visible,.ci-3d-animation-controls button:focus-visible,.ci-3d-error-retry:focus-visible{outline:2px solid #0058a3;outline-offset:2px}@media(prefers-reduced-motion:reduce){.ci-3d-loading-spinner,.ci-3d-progress-bar-fill,.ci-3d-controls button{animation:none!important;transition-duration:.01ms!important}}";class L{constructor(t,o={}){var n,a;this.model=null,this.clock=new c.Clock,this.animationId=null,this.resizeObserver=null,this.lights=null,this.groundPlane=null,this.autoRotateController=null,this.mixer=null,this.currentAction=null,this.clips=[],this.initialCameraPos=new c.Vector3,this.initialCameraTarget=new c.Vector3,this.destroyed=!1,this.loadGeneration=0,this.cameraResetHandle=null,this.toolbar=null,this.loadingOverlay=null,this.loadingText=null,this.progressBarFill=null,this.errorOverlay=null,this.controlsWrapper=null,this.bgToggleBtn=null,this.isDarkBackground=!1,this.throttledCameraChange=null,this.lastCameraPos=new c.Vector3,this.lastCameraTarget=new c.Vector3,this.scrollHint=null,this.scrollHintTimer=null,this.wheelHandler=null,this.onFullscreenChange=()=>{var l,d;const s=this.isFullscreen();s?v(this.container,"ci-3d-container--fullscreen"):k(this.container,"ci-3d-container--fullscreen");const r=this.container.querySelector(".ci-3d-fullscreen-btn");r&&(r.setAttribute("aria-pressed",String(s)),r.setAttribute("aria-label",s?"Exit fullscreen":"Enter fullscreen")),(d=(l=this.config).onFullscreenChange)==null||d.call(l,s)},this.container=dt(t),this.config=z(o);const i=rt(this.config);i.length>0&&console.warn("CI3DView config warnings:",i),ht(Vt,"ci-3d-styles"),this.setupDOM(),this.setupThreeJS(),this.setupLighting(),this.startLoop(),this.resizeObserver=at(this.renderer,this.camera,this.container),this.config.src&&((a=(n=this.config).onLoadStart)==null||a.call(n),this.loadModelInternal(this.config.src,this.config.mtlSrc))}static autoInit(t){const i=(t||document.body).querySelectorAll("[data-ci-3d-src]"),n=[];return i.forEach(a=>{const s=it(a);n.push(new L(a,s))}),n}getThreeObjects(){return{scene:this.scene,camera:this.camera,renderer:this.renderer,controls:this.controls,model:this.model}}getElements(){return{container:this.container,canvas:this.canvas}}async loadModel(t,o){var i,n,a;this.destroyed||((i=this.cameraResetHandle)==null||i.cancel(),this.model&&this.disposeModel(),this.showLoading(),(a=(n=this.config).onLoadStart)==null||a.call(n),await this.loadModelInternal(t,o))}setCameraPosition(t,o,i){this.destroyed||(this.camera.position.set(t,o,i),this.controls.update())}setCameraTarget(t,o,i){this.destroyed||(this.controls.target.set(t,o,i),this.controls.update())}resetCamera(){var t;this.destroyed||((t=this.cameraResetHandle)==null||t.cancel(),this.cameraResetHandle=Ht(this.camera,this.controls,this.initialCameraPos,this.initialCameraTarget))}setAutoRotate(t){var o;t?(this.autoRotateController||(this.autoRotateController=new It(this.controls,{autoRotateSpeed:this.config.autoRotateSpeed??.5,autoRotateDelay:this.config.autoRotateDelay??3e3})),this.autoRotateController.start()):(o=this.autoRotateController)==null||o.stop()}screenshot(t){if(this.destroyed)return"";const o=Math.max(.1,Math.min(t??this.config.screenshotScale??2,8)),i=this.renderer.getSize(new c.Vector2);this.renderer.setSize(i.width*o,i.height*o,!1);try{return this.renderer.render(this.scene,this.camera),this.renderer.domElement.toDataURL("image/png")}catch{return""}finally{this.renderer.setSize(i.width,i.height,!1)}}downloadScreenshot(t,o){const i=this.screenshot(o),n=t??this.config.screenshotFilename??"screenshot",a=document.createElement("a");a.href=i,a.download=`${n}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)}playAnimation(t){if(!this.mixer||this.clips.length===0)return;let o;typeof t=="number"?o=this.clips[t]:typeof t=="string"?o=this.clips.find(i=>i.name===t):o=this.clips[0],o&&(this.currentAction&&this.currentAction.stop(),this.currentAction=this.mixer.clipAction(o),this.currentAction.reset().play())}pauseAnimation(){this.currentAction&&(this.currentAction.paused=!0)}stopAnimation(){this.currentAction&&(this.currentAction.stop(),this.currentAction=null)}setAnimationSpeed(t){this.currentAction&&(this.currentAction.timeScale=t)}getAnimations(){return this.clips.map(t=>t.name)}enterFullscreen(){const t=this.container;t.requestFullscreen?t.requestFullscreen().catch(()=>{}):t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}exitFullscreen(){document.exitFullscreen?document.exitFullscreen().catch(()=>{}):document.webkitExitFullscreen&&document.webkitExitFullscreen()}isFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement)}update(t){if(this.destroyed)return;const o={...this.config};this.config=z({...this.config,...t}),t.theme!==void 0&&t.theme!==o.theme&&(t.theme==="dark"?v(this.container,"ci-3d-theme-dark"):k(this.container,"ci-3d-theme-dark")),t.background!==void 0&&(t.background==="transparent"?this.scene.background=null:this.scene.background=new c.Color(t.background)),t.toneMapping!==void 0&&(this.renderer.toneMapping=st(t.toneMapping)),t.toneMappingExposure!==void 0&&(this.renderer.toneMappingExposure=t.toneMappingExposure),t.shadows!==void 0&&(this.renderer.shadowMap.enabled=t.shadows,!t.shadows&&this.groundPlane&&(W(this.groundPlane,this.scene),this.groundPlane=null)),t.lighting&&this.lights&&Et(this.lights,t.lighting),t.shadowOpacity!==void 0&&this.groundPlane&&(this.groundPlane.material.opacity=t.shadowOpacity),t.autoRotate!==void 0&&this.setAutoRotate(t.autoRotate),t.autoRotateSpeed!==void 0&&this.autoRotateController&&this.autoRotateController.setSpeed(t.autoRotateSpeed),this.controls&&(t.damping!==void 0&&(this.controls.enableDamping=t.damping),t.dampingFactor!==void 0&&(this.controls.dampingFactor=t.dampingFactor),t.zoom!==void 0&&(this.controls.enableZoom=t.zoom),t.pan!==void 0&&(this.controls.enablePan=t.pan),t.controls!==void 0&&(this.controls.enableRotate=t.controls)),t.scrollToZoom!==void 0&&t.scrollToZoom!==o.scrollToZoom&&(t.scrollToZoom?this.detachWheelInterception():this.attachWheelInterception()),t.src!==void 0&&t.src!==o.src&&this.loadModel(t.src,t.mtlSrc).catch(()=>{})}destroy(){var t,o,i,n,a,s,r,l,d,u,h;this.destroyed||(this.destroyed=!0,(t=this.cameraResetHandle)==null||t.cancel(),this.cameraResetHandle=null,this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null),(o=this.toolbar)==null||o.destroy(),(i=this.autoRotateController)==null||i.destroy(),this.mixer&&(this.mixer.stopAllAction(),this.model&&this.mixer.uncacheRoot(this.model)),this.disposeModel(),this.lights&&Pt(this.lights,this.scene),N(this.scene),this.groundPlane&&W(this.groundPlane,this.scene),(n=this.controls)==null||n.dispose(),this.renderer.dispose(),(a=this.throttledCameraChange)==null||a.cancel(),(s=this.resizeObserver)==null||s.disconnect(),this.detachWheelInterception(),this.hideScrollHint(),document.removeEventListener("fullscreenchange",this.onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this.onFullscreenChange),(r=this.scrollHint)==null||r.remove(),(l=this.loadingOverlay)==null||l.remove(),(d=this.errorOverlay)==null||d.remove(),(u=this.controlsWrapper)==null||u.remove(),(h=this.canvas)==null||h.remove(),k(this.container,"ci-3d-container","ci-3d-theme-dark"),ut("ci-3d-styles"))}setupDOM(){var d;v(this.container,"ci-3d-container"),this.config.theme==="dark"&&v(this.container,"ci-3d-theme-dark"),this.container.setAttribute("role","application"),this.container.setAttribute("aria-roledescription","3D viewer"),this.container.setAttribute("aria-label",`3D model viewer: ${this.config.alt||"3D model"}`),this.container.setAttribute("tabindex","0");const t=`ci-3d-kbd-help-${Date.now()}`,o=m("div","ci-3d-sr-only");o.id=t,o.textContent="Use arrow keys to rotate, plus/minus to zoom, 0 to reset camera, R for auto-rotate, F for fullscreen, Space for animation.",this.container.appendChild(o),this.container.setAttribute("aria-describedby",t),this.canvas=m("canvas","ci-3d-canvas"),this.canvas.setAttribute("role","img"),this.canvas.setAttribute("aria-label",this.config.alt||"3D model"),this.container.appendChild(this.canvas),this.loadingOverlay=m("div","ci-3d-loading",{"aria-live":"polite"});const i=m("div","ci-3d-loading-spinner");this.loadingText=m("div","ci-3d-loading-text"),this.loadingText.textContent="Loading...";const n=m("div","ci-3d-progress-bar",{role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":"0"});this.progressBarFill=m("div","ci-3d-progress-bar-fill"),n.appendChild(this.progressBarFill),this.loadingOverlay.appendChild(i),this.loadingOverlay.appendChild(this.loadingText),this.loadingOverlay.appendChild(n),this.container.appendChild(this.loadingOverlay),this.errorOverlay=m("div","ci-3d-error",{role:"alert","aria-live":"assertive"});const a=m("div","ci-3d-error-icon");a.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>';const s=m("div","ci-3d-error-message");s.textContent="Failed to load model";const r=m("button","ci-3d-error-retry");if(r.textContent="Retry",r.setAttribute("aria-label","Retry loading model"),r.addEventListener("click",()=>{this.hideError(),this.showLoading(),this.loadModelInternal(this.config.src,this.config.mtlSrc).catch(()=>{})}),this.errorOverlay.appendChild(a),this.errorOverlay.appendChild(s),this.errorOverlay.appendChild(r),this.container.appendChild(this.errorOverlay),this.config.fullscreenButton||this.config.backgroundToggleButton){if(this.controlsWrapper=m("div","ci-3d-controls"),this.config.fullscreenButton){const u=m("button","ci-3d-fullscreen-btn",{"aria-label":"Enter fullscreen","aria-pressed":"false"});u.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>',u.addEventListener("click",()=>{this.isFullscreen()?this.exitFullscreen():this.enterFullscreen()}),this.controlsWrapper.appendChild(u)}this.config.backgroundToggleButton&&(this.isDarkBackground=this.config.theme==="dark",this.bgToggleBtn=m("button","ci-3d-bg-toggle-btn",{"aria-label":this.isDarkBackground?"Switch to light background":"Switch to dark background"}),this.updateBgToggleIcon(),this.bgToggleBtn.addEventListener("click",()=>{var u;this.isDarkBackground?this.update({theme:"light",background:"#ffffff"}):this.update({theme:"dark",background:"#1a1a1a"}),this.isDarkBackground=!this.isDarkBackground,this.updateBgToggleIcon(),(u=this.bgToggleBtn)==null||u.setAttribute("aria-label",this.isDarkBackground?"Switch to light background":"Switch to dark background")}),this.controlsWrapper.appendChild(this.bgToggleBtn)),this.container.appendChild(this.controlsWrapper)}const l=typeof navigator<"u"&&/Mac|iPhone|iPad|iPod/.test(((d=navigator.userAgentData)==null?void 0:d.platform)??navigator.platform);this.scrollHint=m("div","ci-3d-scroll-hint"),this.scrollHint.textContent=l?"âŒ˜ + scroll to zoom":"Ctrl + scroll to zoom",this.container.appendChild(this.scrollHint),document.addEventListener("fullscreenchange",this.onFullscreenChange),document.addEventListener("webkitfullscreenchange",this.onFullscreenChange)}updateBgToggleIcon(){this.bgToggleBtn&&(this.isDarkBackground?this.bgToggleBtn.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>':this.bgToggleBtn.innerHTML='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>')}setupThreeJS(){this.renderer=nt(this.canvas,this.config);const t=this.container.clientWidth||800,o=this.container.clientHeight||600;this.renderer.setSize(t,o,!1),this.scene=lt(this.config),this.camera=ct(this.config,t/o),this.controls=zt(this.camera,this.canvas,this.config),this.config.scrollToZoom||this.attachWheelInterception()}setupLighting(){this.lights=Lt(this.scene,this.config.lighting)}startLoop(){const t=this.config.onCameraChange;t&&(this.throttledCameraChange=bt((i,n)=>{t(i,n)},1e3/60));const o=()=>{var n,a;if(this.destroyed)return;this.animationId=requestAnimationFrame(o);const i=this.clock.getDelta();if((n=this.controls)==null||n.update(),(a=this.mixer)==null||a.update(i),this.renderer.render(this.scene,this.camera),this.throttledCameraChange){const s=this.camera.position,r=this.controls.target;(!s.equals(this.lastCameraPos)||!r.equals(this.lastCameraTarget))&&(this.lastCameraPos.copy(s),this.lastCameraTarget.copy(r),this.throttledCameraChange({x:s.x,y:s.y,z:s.z},{x:r.x,y:r.y,z:r.z}))}};o()}async loadModelInternal(t,o){var a,s,r,l,d,u;const i=++this.loadGeneration,n=Tt(t);if(!n){this.showError(`Unsupported model format: ${t}`),(s=(a=this.config).onError)==null||s.call(a,new Error(`Unsupported model format: ${t}`));return}try{const h=await n.load(t,{mtlUrl:o,draco:this.config.draco,dracoDecoderPath:this.config.dracoDecoderPath},w=>{var E,C;i===this.loadGeneration&&(this.updateProgress(w),(C=(E=this.config).onProgress)==null||C.call(E,w))});if(this.destroyed||i!==this.loadGeneration){j(h.model);return}this.model=h.model,this.clips=h.animations;const y=R(this.model);gt(this.model,y,2);const x=R(this.model);mt(this.model,x),this.config.shadows&&this.model.traverse(w=>{w instanceof c.Mesh&&(w.castShadow=!0,w.receiveShadow=!0)}),this.scene.add(this.model);const p=pt(this.model);Dt(this.controls,p,this.config),this.lights&&Bt(this.lights,p.radius),this.config.cameraPosition||ft(this.camera,p),this.initialCameraPos.copy(this.camera.position),this.initialCameraTarget.copy(this.controls.target),this.config.shadows&&(this.groundPlane=Ot(x,{shadowOpacity:this.config.shadowOpacity??.3}),this.scene.add(this.groundPlane)),this.config.autoRotate&&this.setAutoRotate(!0),this.config.environmentMap&&(await Ft(this.config.environmentMap,this.renderer,this.scene,this.config.environmentBackground??!1),this.lights&&Rt(this.lights)),this.clips.length>0&&(this.mixer=new c.AnimationMixer(this.model),(this.config.autoPlayAnimation||this.config.animation!==void 0)&&this.playAnimation(this.config.animation),this.config.animationSpeed!==void 0&&this.config.animationSpeed!==1&&this.setAnimationSpeed(this.config.animationSpeed)),this.hideLoading(),this.createToolbar(),(l=(r=this.config).onLoad)==null||l.call(r,this)}catch(h){if(this.destroyed)return;const y=h instanceof Error?h:new Error(String(h));this.showError(y.message),(u=(d=this.config).onError)==null||u.call(d,y)}}createToolbar(){var t,o;(t=this.toolbar)==null||t.destroy(),this.toolbar=null,this.toolbar=Wt(this.container,{resetCameraButton:this.config.resetCameraButton??!0,autoRotateButton:this.config.autoRotateButton??!0,animationButtons:this.config.animationButtons??!0,screenshotButton:this.config.screenshotButton??!1,hasAnimations:this.clips.length>0,autoRotateActive:!!this.autoRotateController,position:this.config.toolbarPosition??"bottom-center"},{onResetCamera:()=>this.resetCamera(),onAutoRotate:i=>this.setAutoRotate(i),onPlay:()=>{var i;this.playAnimation(),(i=this.toolbar)==null||i.setAnimationState(!0)},onPause:()=>{var i;this.pauseAnimation(),(i=this.toolbar)==null||i.setAnimationState(!1)},onStop:()=>{var i;this.stopAnimation(),(i=this.toolbar)==null||i.setAnimationState(!1)},onScreenshot:()=>this.downloadScreenshot()}),this.currentAction&&!this.currentAction.paused&&((o=this.toolbar)==null||o.setAnimationState(!0))}attachWheelInterception(){this.detachWheelInterception(),this.wheelHandler=t=>{t.ctrlKey||t.metaKey?t.preventDefault():(t.stopPropagation(),this.showScrollHint())},this.container.addEventListener("wheel",this.wheelHandler,{capture:!0,passive:!1})}detachWheelInterception(){this.wheelHandler&&(this.container.removeEventListener("wheel",this.wheelHandler,{capture:!0}),this.wheelHandler=null)}showScrollHint(){this.scrollHint&&(v(this.scrollHint,"ci-3d-scroll-hint--visible"),this.scrollHintTimer!==null&&clearTimeout(this.scrollHintTimer),this.scrollHintTimer=setTimeout(()=>{this.hideScrollHint()},1500))}hideScrollHint(){this.scrollHint&&(k(this.scrollHint,"ci-3d-scroll-hint--visible"),this.scrollHintTimer!==null&&(clearTimeout(this.scrollHintTimer),this.scrollHintTimer=null))}disposeModel(){this.mixer&&(this.mixer.stopAllAction(),this.model&&this.mixer.uncacheRoot(this.model),this.mixer=null),this.model&&(this.scene.remove(this.model),j(this.model),this.model=null),this.currentAction=null,this.clips=[]}showLoading(){this.loadingOverlay&&k(this.loadingOverlay,"ci-3d-loading--hidden"),this.loadingText&&(this.loadingText.textContent="Loading..."),this.progressBarFill&&(this.progressBarFill.style.width="0%")}hideLoading(){this.loadingOverlay&&v(this.loadingOverlay,"ci-3d-loading--hidden")}updateProgress(t){var i;const o=Math.round(Math.min(Math.max(t,0),1)*100);this.loadingText&&(this.loadingText.textContent=`Loading... ${o}%`),this.progressBarFill&&(this.progressBarFill.style.width=`${o}%`,(i=this.progressBarFill.parentElement)==null||i.setAttribute("aria-valuenow",String(o)))}showError(t){if(this.hideLoading(),this.errorOverlay){v(this.errorOverlay,"ci-3d-error--visible"),k(this.errorOverlay,"ci-3d-error--hidden");const o=this.errorOverlay.querySelector(".ci-3d-error-message");if(o&&(o.textContent=t),this.container.contains(document.activeElement)||document.activeElement===this.container){const i=this.errorOverlay.querySelector(".ci-3d-error-retry");i==null||i.focus()}}}hideError(){this.errorOverlay&&(k(this.errorOverlay,"ci-3d-error--visible"),v(this.errorOverlay,"ci-3d-error--hidden"))}}f.CI3DView=L,f.default=L,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=js-cloudimage-3d-view.min.js.map
